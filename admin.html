<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å - Pro Jet</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            display: flex;
            height: 100vh;
            background: var(--light-gray);
        }

        .sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h2 {
            font-size: 20px;
            margin-bottom: 30px;
            font-family: 'Montserrat', sans-serif;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 12px;
        }

        .sidebar-menu a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 12px 15px;
            display: block;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: var(--primary);
            color: white;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar h1 {
            margin: 0;
            font-size: 24px;
            color: var(--dark);
        }

        .logout-btn {
            padding: 8px 16px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .dashboard {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-card h3 {
            color: var(--dark-gray);
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-card .subtext {
            font-size: 12px;
            color: #999;
        }

        .orders-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 30px;
        }

        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .orders-header h2 {
            margin: 0;
            font-size: 20px;
            color: var(--dark);
        }

        .filter-group {
            display: flex;
            gap: 12px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }

        .orders-table thead {
            background: var(--light-gray);
        }

        .orders-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            font-size: 13px;
            text-transform: uppercase;
        }

        .orders-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        .orders-table tr:hover {
            background: #fafafa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 11px;
        }

        .status-new { background: #e3f2fd; color: #1976d2; }
        .status-accepted { background: #f3e5f5; color: #7b1fa2; }
        .status-in-progress { background: #fff3e0; color: #f57f17; }
        .status-ready { background: #e8f5e9; color: #388e3c; }
        .status-completed { background: #c8e6c9; color: #1b5e20; }
        .status-cancelled { background: #ffebee; color: #c62828; }

        .action-btn {
            padding: 6px 12px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }

        .btn-view {
            background: var(--primary);
            color: white;
        }

        .btn-edit {
            background: var(--warning);
            color: white;
        }

        .btn-delete {
            background: var(--error);
            color: white;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-dialog {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 13px;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                display: none;
            }

            .sidebar.active {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .orders-table {
                font-size: 12px;
            }

            .orders-table th,
            .orders-table td {
                padding: 10px;
            }

            .action-btn {
                padding: 4px 8px;
                margin: 2px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-group {
                flex-direction: column;
            }

            .filter-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <h2>Pro Jet</h2>
            <ul class="sidebar-menu">
                <li><a href="#" class="menu-link active" onclick="showDashboard()">üìä Dashboard</a></li>
                <li><a href="#" class="menu-link" onclick="showOrders()">üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a></li>
                <li><a href="#" class="menu-link" onclick="showStats()">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
                <li><a href="#" class="menu-link" onclick="showSettings()">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a></li>
                <li><a href="#" class="menu-link" onclick="logout()">üö™ –í–∏—Ö—ñ–¥</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <h1 id="pageTitle">Dashboard</h1>
                <button class="logout-btn" onclick="logout()">–í–∏—Ö—ñ–¥</button>
            </div>

            <!-- Dashboard Content -->
            <div class="dashboard">
                <!-- Stats Section -->
                <div id="dashboardSection" style="display: block;">
                    <h2>–û–≥–ª—è–¥</h2>
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <h3>–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å</h3>
                            <div class="number" id="statTotal">0</div>
                            <div class="subtext">–∑–∞ –≤–µ—Å—å –ø–µ—Ä—ñ–æ–¥</div>
                        </div>
                        <div class="stat-card">
                            <h3>–û—á—ñ–∫—É—î –æ–±—Ä–æ–±–∫–∏</h3>
                            <div class="number" id="statPending">0</div>
                            <div class="subtext">–Ω–æ–≤—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</div>
                        </div>
                        <div class="stat-card">
                            <h3>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</h3>
                            <div class="number" id="statCompleted">0</div>
                            <div class="subtext">—É—Å–ø—ñ—à–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</div>
                        </div>
                        <div class="stat-card">
                            <h3>–ó–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥</h3>
                            <div class="number" id="statRevenue">0 ‚Ç¥</div>
                            <div class="subtext">—Å–ø–ª–∞—á–µ–Ω–æ</div>
                        </div>
                    </div>

                    <!-- Orders Table -->
                    <div class="orders-section">
                        <div class="orders-header">
                            <h2>–û—Å—Ç–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
                            <div class="filter-group">
                                <button class="filter-btn active" onclick="filterOrders('all')">–í—Å—ñ</button>
                                <button class="filter-btn" onclick="filterOrders('new')">–ù–æ–≤—ñ</button>
                                <button class="filter-btn" onclick="filterOrders('in-progress')">–í –ø—Ä–æ—Ü–µ—Å—ñ</button>
                                <button class="filter-btn" onclick="filterOrders('completed')">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</button>
                            </div>
                        </div>

                        <table class="orders-table" id="ordersTable">
                            <thead>
                                <tr>
                                    <th>‚Ññ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                                    <th>–ö–ª—ñ—î–Ω—Ç</th>
                                    <th>–ü–æ—Å–ª—É–≥–∞</th>
                                    <th>–°—É–º–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–î—ñ—è</th>
                                </tr>
                            </thead>
                            <tbody id="ordersBody">
                                <tr><td colspan="7" style="text-align: center; color: #999;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal-dialog">
            <div class="modal-header">–î–µ—Ç–∞–ª—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</div>
            <div class="modal-body" id="orderDetails"></div>
            <button class="btn btn-primary" onclick="closeModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <script>
        // API –±–∞–∑–æ–≤–∏–π URL
        const API_URL = 'http://localhost:3000/api';

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.addEventListener('DOMContentLoaded', function () {
            loadStats();
            loadOrders();
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/admin/stats`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('statTotal').textContent = data.stats.totalOrders;
                    document.getElementById('statPending').textContent = data.stats.pendingOrders;
                    document.getElementById('statCompleted').textContent = data.stats.completedOrders;
                    document.getElementById('statRevenue').textContent = data.stats.totalRevenue.toLocaleString('uk-UA') + ' ‚Ç¥';
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        async function loadOrders(status = 'all') {
            try {
                let url = `${API_URL}/admin/orders`;
                if (status && status !== 'all') {
                    url += `?status=${status}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.success) {
                    const tbody = document.getElementById('ordersBody');
                    tbody.innerHTML = '';

                    if (data.orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">–ù–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</td></tr>';
                        return;
                    }

                    data.orders.forEach(order => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><strong>${order.orderNumber}</strong></td>
                            <td>${order.customer.name}</td>
                            <td>${order.service}</td>
                            <td>${order.pricing.totalPrice.toLocaleString('uk-UA')} ‚Ç¥</td>
                            <td>
                                <span class="status-badge status-${order.status}">
                                    ${order.status}
                                </span>
                            </td>
                            <td>${new Date(order.createdAt).toLocaleDateString('uk-UA')}</td>
                            <td>
                                <button class="action-btn btn-view" onclick="viewOrder('${order._id}')">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å:', error);
            }
        }

        // –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        async function viewOrder(orderId) {
            try {
                const response = await fetch(`${API_URL}/admin/orders/${orderId}`);
                const data = await response.json();

                if (data.success) {
                    const order = data.order;
                    const details = document.getElementById('orderDetails');

                    details.innerHTML = `
                        <div class="form-group">
                            <label>–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</label>
                            <input type="text" value="${order.orderNumber}" readonly>
                        </div>
                        <div class="form-group">
                            <label>–ö–ª—ñ—î–Ω—Ç</label>
                            <input type="text" value="${order.customer.name}" readonly>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" value="${order.customer.email}" readonly>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="text" value="${order.customer.phone}" readonly>
                        </div>
                        <div class="form-group">
                            <label>–ü–æ—Å–ª—É–≥–∞</label>
                            <input type="text" value="${order.service}" readonly>
                        </div>
                        <div class="form-group">
                            <label>–°—É–º–∞</label>
                            <input type="text" value="${order.pricing.totalPrice} ‚Ç¥" readonly>
                        </div>
                        <div class="form-group">
                            <label>–°—Ç–∞—Ç—É—Å</label>
                            <select onchange="updateOrderStatus('${orderId}', this.value)">
                                <option value="new" ${order.status === 'new' ? 'selected' : ''}>–ù–æ–≤–∏–π</option>
                                <option value="accepted" ${order.status === 'accepted' ? 'selected' : ''}>–ü—Ä–∏–π–Ω—è—Ç–æ</option>
                                <option value="in-progress" ${order.status === 'in-progress' ? 'selected' : ''}>–í –ø—Ä–æ—Ü–µ—Å—ñ</option>
                                <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>–ì–æ—Ç–æ–≤–æ</option>
                                <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
                                <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>–°–∫–∞—Å–æ–≤–∞–Ω–æ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ü—Ä–∏–º—ñ—Ç–∫–∞ –¥–ª—è –∞–¥–º—ñ–Ω–∞</label>
                            <textarea onblur="updateOrderNotes('${orderId}', this.value)">${order.internalNotes || ''}</textarea>
                        </div>
                    `;

                    document.getElementById('orderModal').classList.add('active');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:', error);
            }
        }

        // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        async function updateOrderStatus(orderId, status) {
            try {
                const response = await fetch(`${API_URL}/admin/orders/${orderId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status })
                });

                if (response.ok) {
                    loadOrders();
                    alert('–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ!');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:', error);
            }
        }

        // –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–∏–º—ñ—Ç–∫—É
        async function updateOrderNotes(orderId, notes) {
            try {
                await fetch(`${API_URL}/admin/orders/${orderId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ internalNotes: notes })
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–º—ñ—Ç–∫–∏:', error);
            }
        }

        // –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        function filterOrders(status) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadOrders(status === 'all' ? '' : status);
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –º–µ–Ω—é
        function showDashboard() { console.log('Dashboard'); }
        function showOrders() { console.log('Orders'); }
        function showStats() { console.log('Stats'); }
        function showSettings() { console.log('Settings'); }

        // –ó–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å
        function closeModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        // –í–∏—Ö—ñ–¥
        function logout() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–π—Ç–∏?')) {
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
