<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Jet - –ú—ñ–π –ü—Ä–æ—Ñ—ñ–ª—å</title>
    <meta name="description" content="–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ Pro Jet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .profile-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 50px;
        }

        .profile-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            margin-bottom: 15px;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .profile-email {
            color: #999;
            font-size: 14px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #999;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(29, 180, 179, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: #12a29f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(29, 180, 179, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--dark-gray);
            flex: 1;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .message {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: #efe;
            color: var(--success);
        }

        .message.error {
            background: #fee;
            color: var(--error);
        }

        .order-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .order-number {
            font-weight: 600;
            color: var(--dark);
        }

        .order-date {
            color: #999;
            font-size: 13px;
        }

        .order-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .profile-header {
                grid-template-columns: 1fr;
            }

            .order-card {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <svg class="logo-svg" viewBox="0 0 100 100">
                        <rect x="20" y="20" width="15" height="60" fill="#1db4b3"/>
                        <rect x="40" y="20" width="15" height="60" fill="#1db4b3"/>
                        <rect x="60" y="20" width="15" height="60" fill="#1db4b3"/>
                        <circle cx="50" cy="50" r="35" fill="none" stroke="#1db4b3" stroke-width="3"/>
                    </svg>
                    <span class="logo-text">Pro Jet</span>
                </a>
                <nav class="nav" id="nav">
                    <a href="index.html" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
                    <a href="gallery.html" class="nav-link">–ì–∞–ª–µ—Ä–µ—è</a>
                    <a href="shop.html" class="nav-link">–ú–∞–≥–∞–∑–∏–Ω</a>
                    <a href="profile.html" class="nav-link">–ü—Ä–æ—Ñ—ñ–ª—å</a>
                </nav>
                <button class="menu-toggle" id="menuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Profile Content -->
    <div class="profile-container">
        <!-- Header Section -->
        <div class="profile-header">
            <div class="profile-card">
                <div class="profile-info">
                    <div class="profile-avatar" id="profileAvatar">üë§</div>
                    <div class="profile-name" id="profileName">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                    <div class="profile-email" id="profileEmail">-</div>

                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalOrders">0</div>
                            <div class="stat-label">–ó–∞–º–æ–≤–ª–µ–Ω—å</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalSpent">0‚Ç¥</div>
                            <div class="stat-label">–í–∏—Ç—Ä–∞—á–µ–Ω–æ</div>
                        </div>
                    </div>

                    <button class="btn btn-danger" onclick="logout()">–í–∏–π—Ç–∏</button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="profile-card">
                <h3 style="margin-bottom: 20px;">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 5px;">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                        <div id="profilePhone" style="font-weight: 500;">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 5px;">–ú—ñ—Å—Ç–æ</div>
                        <div id="profileCity" style="font-weight: 500;">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 5px;">–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</div>
                        <div id="profileDate" style="font-weight: 500;">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content with Tabs -->
        <div class="profile-card">
            <div class="tabs">
                <button class="tab-btn active" data-tab="profile">–ü—Ä–æ—Ñ—ñ–ª—å</button>
                <button class="tab-btn" data-tab="address">–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</button>
                <button class="tab-btn" data-tab="orders">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
            </div>

            <!-- Profile Tab -->
            <div class="tab-content active" id="profileTab">
                <div class="message" id="profileMessage"></div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editFirstName">–Ü–º'—è</label>
                        <input type="text" id="editFirstName" placeholder="–Ü–≤–∞–Ω">
                    </div>
                    <div class="form-group">
                        <label for="editLastName">–ü—Ä—ñ–∑–≤–∏—â–µ</label>
                        <input type="text" id="editLastName" placeholder="–ü–µ—Ç—Ä–µ–Ω–∫–æ">
                    </div>
                </div>

                <div class="form-group">
                    <label for="editPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="editPhone" placeholder="+380 50 123 45 67">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editCity">–ú—ñ—Å—Ç–æ</label>
                        <input type="text" id="editCity" placeholder="–ö–∏—ó–≤">
                    </div>
                    <div class="form-group">
                        <label for="editRegion">–û–±–ª–∞—Å—Ç—å</label>
                        <input type="text" id="editRegion" placeholder="–ö–∏—ó–≤—Å—å–∫–∞">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editStreet">–í—É–ª–∏—Ü—è</label>
                        <input type="text" id="editStreet" placeholder="–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1">
                    </div>
                    <div class="form-group">
                        <label for="editPostal">–ü–æ—à—Ç–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å</label>
                        <input type="text" id="editPostal" placeholder="01001">
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveProfile()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                    <button class="btn btn-secondary" onclick="resetProfile()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                </div>
            </div>

            <!-- Address Tab -->
            <div class="tab-content" id="addressTab">
                <div class="message" id="addressMessage"></div>

                <h3 style="margin-bottom: 20px;">–ê–¥—Ä–µ—Å–∞ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ù–æ–≤–∞ –ü–æ—à—Ç–∞</h3>

                <div class="form-group">
                    <label for="npRecipient">–ü–Ü–ë –æ—Ç—Ä–∏–º—É–≤–∞—á–∞</label>
                    <input type="text" id="npRecipient" placeholder="–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ">
                </div>

                <div class="form-group">
                    <label for="npPhone">–¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç—Ä–∏–º—É–≤–∞—á–∞</label>
                    <input type="tel" id="npPhone" placeholder="+380 50 123 45 67">
                </div>

                <div class="form-group">
                    <label for="npCity">–ú—ñ—Å—Ç–æ</label>
                    <input type="text" id="npCity" placeholder="–ö–∏—ó–≤">
                </div>

                <div class="form-group">
                    <label for="npDepartment">–ù–æ–º–µ—Ä –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–æ–≤–∞ –ü–æ—à—Ç–∞</label>
                    <input type="text" id="npDepartment" placeholder="1" maxlength="6">
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveAddress()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∞–¥—Ä–µ—Å—É</button>
                    <button class="btn btn-secondary" onclick="resetAddress()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                </div>
            </div>

            <!-- Orders Tab -->
            <div class="tab-content" id="ordersTab">
                <h3 style="margin-bottom: 20px;">–í–∞—à—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
                <div id="ordersList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <p>–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        const API_URL = 'http://localhost:3000/api';
        let currentUser = null;

        class UserManager {
            constructor() {
                this.token = localStorage.getItem('auth-token');
            }

            async getProfile() {
                try {
                    const response = await fetch(`${API_URL}/users/profile`, {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                    throw error;
                }
            }

            async updateProfile(data) {
                try {
                    const response = await fetch(`${API_URL}/users/profile`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.token}`
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                    throw error;
                }
            }

            async updateAddress(data) {
                try {
                    const response = await fetch(`${API_URL}/users/address`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.token}`
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ –∞–¥—Ä–µ—Å—É');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                    throw error;
                }
            }
        }

        const userManager = new UserManager();

        // Check authentication
        document.addEventListener('DOMContentLoaded', async function() {
            if (!localStorage.getItem('auth-token')) {
                window.location.href = 'auth.html';
                return;
            }

            try {
                const result = await userManager.getProfile();
                currentUser = result.user;
                displayProfile();
                loadOrders();
                setupTabs();
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
                localStorage.removeItem('auth-token');
                window.location.href = 'auth.html';
            }
        });

        function displayProfile() {
            // Avatar
            const firstLetters = (currentUser.firstName[0] + currentUser.lastName[0]).toUpperCase();
            document.getElementById('profileAvatar').textContent = firstLetters;

            // Profile info
            document.getElementById('profileName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profilePhone').textContent = currentUser.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ';
            document.getElementById('profileCity').textContent = currentUser.address?.city || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ';
            document.getElementById('totalOrders').textContent = currentUser.totalOrders || 0;
            document.getElementById('totalSpent').textContent = (currentUser.totalSpent || 0) + '‚Ç¥';

            // Format date
            if (currentUser.createdAt) {
                const date = new Date(currentUser.createdAt);
                document.getElementById('profileDate').textContent = date.toLocaleDateString('uk-UA');
            }

            // Fill form fields
            document.getElementById('editFirstName').value = currentUser.firstName;
            document.getElementById('editLastName').value = currentUser.lastName;
            document.getElementById('editPhone').value = currentUser.phone || '';
            document.getElementById('editCity').value = currentUser.address?.city || '';
            document.getElementById('editRegion').value = currentUser.address?.region || '';
            document.getElementById('editStreet').value = currentUser.address?.street || '';
            document.getElementById('editPostal').value = currentUser.address?.postalCode || '';

            // Fill address fields
            if (currentUser.novaPoshtaInfo) {
                document.getElementById('npRecipient').value = currentUser.novaPoshtaInfo.recipient || '';
                document.getElementById('npPhone').value = currentUser.novaPoshtaInfo.phone || '';
                document.getElementById('npCity').value = currentUser.novaPoshtaInfo.departmentCity || '';
                document.getElementById('npDepartment').value = currentUser.novaPoshtaInfo.department || '';
            }
        }

        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        async function saveProfile() {
            try {
                const data = {
                    firstName: document.getElementById('editFirstName').value,
                    lastName: document.getElementById('editLastName').value,
                    phone: document.getElementById('editPhone').value,
                    city: document.getElementById('editCity').value,
                    region: document.getElementById('editRegion').value,
                    street: document.getElementById('editStreet').value,
                    postalCode: document.getElementById('editPostal').value
                };

                const result = await userManager.updateProfile(data);
                currentUser = result.user;

                const msg = document.getElementById('profileMessage');
                msg.textContent = '‚úì –ü—Ä–æ—Ñ—ñ–ª—å —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ';
                msg.className = 'message show success';

                setTimeout(() => msg.classList.remove('show'), 3000);
            } catch (error) {
                const msg = document.getElementById('profileMessage');
                msg.textContent = error.message;
                msg.className = 'message show error';
            }
        }

        function resetProfile() {
            displayProfile();
        }

        async function saveAddress() {
            try {
                const data = {
                    recipient: document.getElementById('npRecipient').value,
                    phone: document.getElementById('npPhone').value,
                    departmentCity: document.getElementById('npCity').value,
                    department: document.getElementById('npDepartment').value
                };

                const result = await userManager.updateAddress(data);
                currentUser = result.user;

                const msg = document.getElementById('addressMessage');
                msg.textContent = '‚úì –ê–¥—Ä–µ—Å–∞ —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–∞';
                msg.className = 'message show success';

                setTimeout(() => msg.classList.remove('show'), 3000);
            } catch (error) {
                const msg = document.getElementById('addressMessage');
                msg.textContent = error.message;
                msg.className = 'message show error';
            }
        }

        function resetAddress() {
            if (currentUser.novaPoshtaInfo) {
                document.getElementById('npRecipient').value = currentUser.novaPoshtaInfo.recipient || '';
                document.getElementById('npPhone').value = currentUser.novaPoshtaInfo.phone || '';
                document.getElementById('npCity').value = currentUser.novaPoshtaInfo.departmentCity || '';
                document.getElementById('npDepartment').value = currentUser.novaPoshtaInfo.department || '';
            }
        }

        function loadOrders() {
            // Placeholder - w√ºrde Orders vom API laden
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üì¶</div>
                    <p>–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
                </div>
            `;
        }

        function logout() {
            localStorage.removeItem('auth-token');
            localStorage.removeItem('user');
            window.location.href = 'auth.html';
        }
    </script>
</body>
</html>
